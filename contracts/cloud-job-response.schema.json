{
   "$schema":"http://json-schema.org/draft-07/schema#",
   "title": "cloudJobResponse",
   "type":"object",
   "required": ["jobId","caseId","status","progress","createdAt","updatedAt"],
   "additionalProperties": false,
   "allOf": [
      {
         "if": {"properties": {"status":{"const":"DONE"}},"required": ["status"]},
         "then": {"required": ["result"],"properties": {"error":{"type":"null"}}}
      },
      {
         "if": {"properties": {"status":{"const":"FAILED"}},"required": ["status"]},
         "then": {"required": ["error"],"properties": {"result":{"type":"null"}}}
      }
   ],                      
   "properties": {
      "jobId":{
         "type":"string"
      },
      "caseId":{
         "type":"string"
      },
      "status":{
         "type":"string",
         "enum": ["PENDING","RUNNING","DONE","FAILED"]
      },
      "progress":{
         "type":"integer",
         "maximum": 100,
         "minimum": 0
      },
      "result":{
         "type":["object","null"],
         "additionalProperties": false,
         
         "properties": {
            "riskScore":{
               "type":"integer",
               "minimum": 0,
               "maximum": 100
            },

            "riskLevel":{
               "type":"string",
               "enum": ["LOW","MEDIUM","HIGH"]
            },

            "detectedSignals":{
               "type":"array",
               "items": {
                  "type":"string",
                  "enum": ["EMAIL_PATTERN","NUMERIC_ID_PATTERN","URL_PATTERN","SECRET_KEYWORD"]
               }
            },

            "recommendation":{"type":"string"}                        
         },
         "required": ["riskScore","riskLevel","detectedSignals","recommendation"]
      },

      "error":{
         "type":["object","null"],
         "additionalProperties": false,
         "properties": {
            "code":{"type":"string"},
            "message":{"type":"string"}
         },
         "required": ["code","message"]
      },

      "createdAt":{
         "type":"string",
         "format": "date-time"
      },

      "updatedAt":{
         "type":"string",
         "format": "date-time"
      }
   }
}